package me.accessmodifier364.leuxbackdoor.client.modules.exploit;

import me.accessmodifier364.leuxbackdoor.client.event.events.EventPacket;
import me.accessmodifier364.leuxbackdoor.client.guiscreen.settings.Setting;
import me.accessmodifier364.leuxbackdoor.client.modules.Category;
import me.accessmodifier364.leuxbackdoor.client.modules.Module;
import me.accessmodifier364.leuxbackdoor.client.util.MessageUtil;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;
import net.minecraft.client.Minecraft;
import net.minecraft.init.SoundEvents;
import net.minecraft.network.play.server.SPacketEffect;
import net.minecraft.network.play.server.SPacketSoundEffect;
import net.minecraft.network.play.server.SPacketSpawnMob;
import net.minecraft.util.SoundCategory;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.MathHelper;

public class GlobalLocation extends Module {
    public GlobalLocation() {
        super(Category.exploit);
        this.name = "GlobalLocation";
        this.description = "ez exploit";
    }
    Setting thunder = create("Thunder", "Thunder", true);
    Setting slimes = create("Slimes", "Slimes", false);
    Setting wither = create("Wither", "Wither", false);
    Setting end_portal = create("End Portal", "EndPortal", true);
    Setting ender_dragon = create("Ender Dragon", "EnderDragon", false);
    Setting donkey = create("Donkey", "Donkey", false);

    @EventHandler
    private final Listener<EventPacket> packet_event = new Listener<>(event -> {
        if (event.get_packet() instanceof SPacketSpawnMob) {
            SPacketSpawnMob packet = (SPacketSpawnMob) event.get_packet();
            if (this.slimes.get_value(true)) {
                Minecraft mc = Minecraft.getMinecraft();
                if (packet.getEntityType() == 55 && packet.getY() <= 40.0 && !mc.world.getBiome(mc.player.getPosition()).getBiomeName().toLowerCase().contains("swamp")) {
                    BlockPos pos = new BlockPos(packet.getX(), packet.getY(), packet.getZ());
                    MessageUtil.send_client_message("Slime Spawned in chunk X:" + mc.world.getChunk(pos).x + " Z:" + mc.world.getChunk(pos).z);
                }
            }
            if (this.donkey.get_value(true) && packet.getEntityType() == 31) {
                MessageUtil.send_client_message(String.format("Donkey spawned at %s %s %s", packet.getX(), packet.getY(), packet.getZ()));
            }
        } else if (event.get_packet() instanceof SPacketSoundEffect) {
            SPacketSoundEffect packet = (SPacketSoundEffect) event.get_packet();
            if (this.thunder.get_value(true) && packet.getCategory() == SoundCategory.WEATHER && packet.getSound() == SoundEvents.ENTITY_LIGHTNING_THUNDER) {
                float yaw = 0.0f;
                double difX = packet.getX() - Minecraft.getMinecraft().player.posX;
                double difZ = packet.getZ() - Minecraft.getMinecraft().player.posZ;
                yaw = (float) ((double) yaw + MathHelper.wrapDegrees(Math.toDegrees(Math.atan2(difZ, difX)) - 90.0 - (double) yaw));
                MessageUtil.send_client_message("Lightning spawned X:" + Minecraft.getMinecraft().player.posX + " Z:" + Minecraft.getMinecraft().player.posZ + " Angle:" + yaw);
            }
        } else if (event.get_packet() instanceof SPacketEffect) {
            SPacketEffect packet = (SPacketEffect) event.get_packet();
            if (packet.getSoundType() == 1023 && this.wither.get_value(true)) {
                double theta = Math.atan2((double) packet.getSoundPos().getZ() - Minecraft.getMinecraft().player.posZ, (double) packet.getSoundPos().getX() - Minecraft.getMinecraft().player.posX);
                double angle = Math.toDegrees(theta + 1.5707963267948966);
                if (angle < 0.0) {
                    angle += 360.0;
                }
                MessageUtil.send_client_message("Wither spawned in direction " + (angle - 180.0) + " with y position: " + packet.getSoundPos().getY());
            } else if (packet.getSoundType() == 1038 && this.end_portal.get_value(true)) {
                MessageUtil.send_client_message("End portal spawned at " + packet.getSoundPos().toString());
            } else if (packet.getSoundType() == 1028 && this.ender_dragon.get_value(true)) {
                MessageUtil.send_client_message("Ender dragon died at " + packet.getSoundPos().toString());
            }
        }
    });
}
